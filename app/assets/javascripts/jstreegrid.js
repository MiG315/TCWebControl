(function(b){var t,E,C,z=!1,F=!1;C=/<\/?[^>]+>/gi;t=function(a,b){var e,c="a"===a.get(0).tagName.toLowerCase()?a:a.children("a"),k=parseInt(b.data.grid.columns[0].width)+parseInt(b.data.grid.treeWidthDiff);e=c.parentsUntil(b.get_container().get(0).tagName+".jstree").filter("li").length;c.css({width:k-18*e,"vertical-align":"top",overflow:"hidden","float":"left"})};E=function(b,f,e){b="a"===b.get(0).tagName.toLowerCase()?b:b.children("a");var c,k=e.data.grid.columns[0];c="";k.title&&("_DATA_"===k.title?
c=e.get_text(f):f.attr(k.title)&&(c=f.attr(k.title)));(c=c.replace(C,""))&&b.attr("title",c)};b.jstree.plugin("grid",{__init:function(){var a=this._get_settings().grid||{};this.data.grid.columns=a.columns||[];this.data.grid.treeClass="jstree-grid-col-0";this.data.grid.columnWidth=a.width;this.data.grid.defaultConf={display:"inline-block","*display":"inline","*+display":"inline","float":"left"};this.data.grid.isThemeroller=!!this.data.themeroller;this.data.grid.treeWidthDiff=0;this.data.grid.resizable=
a.resizable;/msie/.test(navigator.userAgent.toLowerCase())&&8>parseFloat(navigator.appVersion.split("MSIE")[1])&&(this.data.grid.defaultConf.display="inline",this.data.grid.defaultConf.zoom="1");F||(F=!0,a=".jstree-grid-cell {padding-left: 4px; vertical-align: top; overflow:hidden;},.jstree-grid-separator {display: inline-block; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;float:left;},.jstree-grid-header-cell {float: left;},.jstree-grid-header-themeroller {border: 0; padding: 1px 3px;},.jstree-grid-header-regular {background-color: #EBF3FD;},.jstree-grid-resizable-separator {cursor: col-resize;},.jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;},.jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}".split(","),
b('<style type="text/css">'+a.join("\n")+"</style>").appendTo("head"));this.get_container().bind("open_node.jstree create_node.jstree clean_node.jstree change_node.jstree",b.proxy(function(a,e){var c=e&&e.rslt&&e.rslt.obj?e.rslt.obj:a.target,c=b(c);this._prepare_grid(c)},this)).bind("loaded.jstree",b.proxy(function(b){this._prepare_headers();this._prepare_grid();this.get_container().trigger("loaded_grid.jstree")},this)).bind("move_node.jstree",b.proxy(function(a,e){var c=e.rslt.o;t(c,this);c.find("li > a").each(b.proxy(function(c,
a){t(b(a),this)},this))},this));this.data.grid.isThemeroller&&this.get_container().bind("select_node.jstree",b.proxy(function(b,a){a.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).bind("deselect_node.jstree deselect_all.jstree",b.proxy(function(b,a){a.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).bind("hover_node.jstree",b.proxy(function(b,a){a.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).bind("dehover_node.jstree",
b.proxy(function(b,a){a.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},__destroy:function(){var a=this.data.grid.parent,f=this.get_container();f.detach();b("div.jstree-grid-wrapper",a).remove();a.append(f)},defaults:{width:25},_fn:{_prepare_headers:function(){var a,f,e=this.data.grid.columns||[],c,k=this.data.grid.columnWidth,u=this.data.grid.resizable||!1,w,t,v,p=this.data.grid.isThemeroller,x=p?"themeroller":"regular",G=this.get_container(),q=G.parent(),y=0,A=this.data.grid.defaultConf,
g=!1,h=0,r=0,l=null,m=0,s=null,n=null,d=0;this.data.grid.parent=q;a=this.data.grid.header||b("<div></div>").addClass((p?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+x);for(f=0;f<e.length;f++)w=e[f].headerClass||"",(t=e[f].header||"")&&(y=!0),c=e[f].width||k,d=p?7:10,c-=d,v=0===f?3:0,c=b("<div></div>").css(A).css({"margin-left":v,width:c,padding:"1 3 2 5"}).addClass((p?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+x+" "+w).text(t).appendTo(a).after("<div class='jstree-grid-separator jstree-grid-separator-"+
x+(p?" ui-widget-header":"")+(u?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>");c.addClass((p?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+x);b("<div></div>").css("clear","both").appendTo(a);y&&(b("<div></div>").addClass("jstree-grid-wrapper").appendTo(q).append(a).append(G),this.data.grid.divOffset=a.parent().offset().left,this.data.grid.header=a);!z&&u&&(z=!0,b(document).on("selectstart",".jstree-grid-separator",function(){return!1}),b(document).on("mousedown",".jstree-grid-separator",
function(a){n=b(this);g=!0;l=n.parents(".jstree-grid-wrapper").children(".jstree");h=a.clientX;m=n.prevAll(".jstree-grid-header").length-1;s=n.prev().add(l.find(".jstree-grid-col-"+m));return!1}),b(document).mouseup(function(){var a,c,e,f;if(g){a=b.jstree._reference(l);c=a.data.grid.columns;f=n.parent().children(".jstree-grid-header");e={};m||(a.data.grid.treeWidthDiff=l.find("ins:eq(0)").width()+l.find("a:eq(0)").width()-a.data.grid.columns[0].width);g=!1;for(a=0;a<c.length;a++)e[c[a].header]={w:parseFloat(f[a].style.width)+
d,r:a===m};l.trigger("resize_column.jstree-grid",[e])}}).mousemove(function(a){if(g){r=a.clientX;var b=r-h;s.each(function(){this.style.width=parseFloat(this.style.width)+b+"px"});h=r}}))},_prepare_grid:function(a){var f=this.data.grid.treeClass,e=this,c,k=this.data.grid.columns||[],u,w=this.data.grid.isThemeroller,z=w?"themeroller":"regular",v,p=this.data.grid.columnWidth,x=this.data.grid.defaultConf;a=a&&-1!==a?this._get_node(a):this.get_container();a.each(function(){var a,q,y,A,g,h,r,l,m,s,n,d,
D,B;c=b(this);g=c.children("a");n=g.hasClass(f);if(1===g.length){g.prev().css("float","left");g.addClass(f);t(g,e);E(g,c,e);h=g;for(a=1;a<k.length;a++)d=k[a],B=d.source||"attr",y=d.cellClass||"",A=d.wideCellClass||"","attr"===B?q=d.value&&c.attr(d.value)?c.attr(d.value):"":"metadata"===B&&(q=d.value&&c.data(d.value)?c.data(d.value):""),d.images?(v=d.images[q]||d.images["default"])&&(D="*"===v[0]?'<span class="'+v.substr(1)+'"></span>':'<img src="'+v+'">'):D=q,(r=d.valueClass&&c.attr(d.valueClass)?
c.attr(d.valueClass):"")&&(d.valueClassPrefix&&""!==d.valueClassPrefix)&&(r=d.valueClassPrefix+r),(l=d.wideValueClass&&c.attr(d.wideValueClass)?c.attr(d.wideValueClass):"")&&(d.wideValueClassPrefix&&""!==d.wideValueClassPrefix)&&(l=d.wideValueClassPrefix+l),s=d.title&&c.attr(d.title)?c.attr(d.title):"",s=s.replace(C,""),u=d.width||p,u=(m=b.support.boxModel?b(".jstree-grid-col-"+a+":first",c).width():b(".jstree-grid-col-"+a+":first",c).outerWidth())||u-7,h=n?g.nextAll("div:eq("+(a-1)+")"):b("<div></div>").insertAfter(h),
m=n?h.children("span"):b("<span></span>").appendTo(h),m.addClass(y+" "+r).css({"margin-right":"0px",display:"inline-block","*display":"inline","*+display":"inline"}).html(D).click(function(a,c,d){return function(){b(this).trigger("select_cell.jstree-grid",[{value:a,column:c.header,node:b(this).closest("li"),sourceName:c.value,sourceType:d}])}}(q,d,B)),h=h.css(x).css({width:u,"padding-left":"7px"}).addClass("jstree-grid-cell jstree-grid-cell-"+z+" "+A+" "+l+(w?" ui-state-default":"")).addClass("jstree-grid-col-"+
a),s&&m.attr("title",s);h.addClass("jstree-grid-cell-last"+(w?" ui-state-default":""));b("<div></div>").css("clear","both").insertAfter(h)}});a.is("li")?this._repair_state(a):a.find("> ul > li").each(function(){e._repair_state(this)});b(".jstree").css({"overflow-y":"auto !important"})}}})})(jQuery);
